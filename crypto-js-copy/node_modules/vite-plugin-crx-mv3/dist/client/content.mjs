import {
  RELOAD,
  UPDATE_CONTENT,
  VITE_PLUGIN_CRX_MV3
} from "../chunk-X5N3P3FY.mjs";

// src/client/content.ts
var ws = new WebSocket(`ws://localhost:${PORT}/${MENIFEST_NAME}/crx`);
var timer;
ws.onopen = function() {
  if (timer)
    clearInterval(timer);
  timer = setInterval(() => {
    ws.send(JSON.stringify({ type: "ping" }));
  }, 5e3);
  console.log(`[${VITE_PLUGIN_CRX_MV3}] connection established`);
};
ws.onmessage = function(e) {
  var _a;
  if (e.data === UPDATE_CONTENT && ((_a = chrome.runtime) == null ? void 0 : _a.id)) {
    chrome.runtime.sendMessage({ msg: RELOAD }, () => {
      if (RELOADPAGE)
        window.location.reload();
      else
        console.log(
          `[${VITE_PLUGIN_CRX_MV3}] extension reload, pls refresh the page manually`
        );
    });
  }
};
ws.onclose = function() {
  if (timer)
    clearInterval(timer);
  console.log(`[${VITE_PLUGIN_CRX_MV3}] connection closed.`);
};
